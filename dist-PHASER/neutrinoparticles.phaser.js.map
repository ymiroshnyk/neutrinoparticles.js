{"version":3,"sources":["PhaserNeutrino.js","PhaserNeutrinoContext.js","PhaserNeutrinoEffect.js","PhaserNeutrinoEffectModel.js","PhaserNeutrinoMaterials.js","PhaserNeutrinoRenderBuffers.js"],"names":["PhaserNeutrino","config","effects","textures","neutrinoContext","PhaserNeutrinoContext","game","renderer","console","warn","noiseGenerator","neutrino","NoiseGenerator","step","path","effectScript","PhaserNeutrinoEffectModel","model","props","position","scale","rotation","PhaserNeutrinoEffect","Phaser","Game","prototype","GameObjectFactory","effect","createEffect","stage","addChild","GameObjectCreator","effectsBasePath","texturesBasePath","NeutrinoParticles","trimmedExtensionLookupFirst","type","PIXI","WEBGL_RENDERER","materials","PhaserNeutrinoMaterials","success","fail","initializeNoise","loadEffect","effectModel","_renderCanvas","renderCanvas","_renderWebGL","renderWebGL","ctx","set","positionZ","onReady","Signal","Array","isArray","x","y","scaleZ","isReady","_onEffectReady","addOnce","dt","update","axisangle2quat_","context","setTransform","draw","gl","renderSession","spriteBatch","stop","projection","offset","setup","fillGeometryBuffers","renderBuffers","updateGlBuffers","bind","renderCallIdx","numRenderCalls","renderCall","renderCalls","texIndex","renderStyles","renderStyleIndex","textureIndices","texture","glTexture","baseTexture","_glTextures","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","materialIndex","switchToNormal","switchToAdd","switchToMultiply","drawElements","TRIANGLES","numIndices","UNSIGNED_SHORT","startIndex","restart","resetPosition","name","value","setPropertyInAllEmitters","getNumParticles","CANVAS_RENDERER","createCanvas2DInstance","textureDescs","textureImageDescs","PhaserNeutrinoRenderBuffers","createWGLInstance","texturesRemap","forEach","updateTexture","dispatch","Group","effectPath","numTexturesToLoadLeft","_names","pixiNeutrinoEffect","_onEffectLoaded","load","onFileComplete","add","progress","key","texturePath","imageIndex","tx","_getNewTexture","_onTextureLoaded","replace","id","_getKey","imageCache","cache","_cache","image","imageData","Object","keys","data","fNames","frameData","_frameNames","hasOwnProperty","frameIndex","frame","_frames","rect","Rectangle","width","height","Texture","base","orig","numTextures","length","_loadTexture","hasLoaded","callback","self","off","on","loader","start","index","source","ImageDesc","crop","_initTexturesRemapIfNeeded","remapNeeded","texIdx","_isSubtexture","n","SubRect","PhaserNeutrinoShader","program","_UID","attributes","vertexPositionAttribute","colorAttribute","textureCoordAttribute","vertexShaderSource","fragmentShaderSource","fragmentShaderMultiplySource","shaderProgram","_makeShaderProgram","shaderProgramMultiply","shader","shaderManager","setShader","pMatrix","currentProgram","projectionVector","offsetVector","slice","_setProgram","blendModeManager","setBlendMode","uniform2fv","projectionVectorUniform","offsetVectorUniform","uniform1i","samplerUniform","uniform2f","scaleUniform","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","alert","getShaderInfoLog","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","useProgram","getAttribLocation","getUniformLocation","geometryBuffers","positions","colors","texCoords","maxNumVertices","numVertices","indices","maxNumRenderCalls","texChannels","Float32Array","ArrayBuffer","Uint8Array","texChannel","numComponents","Uint16Array","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","colorBuffer","texBuffers","buffer","push","indicesBuffer","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","vertex","color","rc","assign","bufferSubData","vertexAttribPointer","positionAttribLocation","FLOAT","colorAttribLocation","UNSIGNED_BYTE","texAttribLocation","deleteBuffer"],"mappings":"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","file":"neutrinoparticles.phaser.js","sourcesContent":["\n/*\n  // Desired interface for NP in Phaser:\n  game.neutrino.init({\n    effects: \"export_js/\", // \"\" by default\n    textures: \"textures/\" // \"\" by default\n  });\n\n  game.neutrino.generateTurbulance(); // to generate turbulance texture\n  game.neturino.loadTurbulance(\"path_to_noise_texture\"); // to load turbulance texture\n\n  model = game.neutrino.loadModel(\"path_to_effect_file\");\n\n  effect = game.add.neutrino(model, {\n    position: [400, 300, 0], // [0, 0, 0] by default\n    rotation: 45, // 0 by default\n    scale: [1, 1] // [1, 1] by default\n  });\n\n*/\nclass PhaserNeutrino {\n\n  constructor(){\n\n  }\n\n  init(config){\n    const effects = (config && config.effects) || \"export_js/\";\n    const textures = (config && config.textures) || \"textures/\";\n    //TODO instantiate a PhaserNeutrinoContext\n    this.neutrinoContext = new PhaserNeutrinoContext(game.renderer, effects, textures);\n    return this.neutrinoContext;\n  }\n\n  generateTurbulance(){\n    if(!this.neutrinoContext) {\n      console.warn('PhaserNeutrino - call init first');\n      return;\n    }\n    const noiseGenerator = new this.neutrinoContext.neutrino.NoiseGenerator();\n    while (!noiseGenerator.step()) { // approx. 5,000 steps\n      // you can use 'noiseGenerator.progress' to get generating progress from 0.0 to 1.0\n    }\n  }\n\n  loadTurbulance(path){\n    //TODO -\n  }\n\n  /**\n   *\n   * @param effectScript\n   * @returns {*}\n   */\n  loadModel(effectScript){\n    if(!this.neutrinoContext) {\n      console.warn('PhaserNeutrino - call init first');\n      return;\n    }\n    return new PhaserNeutrinoEffectModel(this.neutrinoContext, effectScript)\n  }\n\n  /**\n   *\n   * @param model\n   * @param props\n   * @param game\n   * @returns {PhaserNeutrinoEffect}\n   */\n  createEffect(model, props, game){\n    let {position, scale, rotation} = props;\n    if(!position) position = [0, 0, 0];\n    if(!scale) scale = [1, 1, 1];\n    if(!rotation) rotation = 0;\n\n    //(effectModel, position, game, rotation, scale)\n    return new PhaserNeutrinoEffect(\n      model,\n      position,\n      game,\n      rotation,\n      scale\n    );\n  }\n}\n\nPhaser.Game.prototype.neutrino = new PhaserNeutrino();\n\n//game.add.neutrino();\nPhaser.GameObjectFactory.prototype.neutrino = function (model, props) {\n  const effect = Phaser.Game.prototype.neutrino.createEffect(model, props, this.game);\n  game.stage.addChild(effect);\n  return effect;\n};\n\n//game.make.neutrino();\nPhaser.GameObjectCreator.prototype.neutrino = function (model, props) {\n  return Phaser.Game.prototype.neutrino.createEffect(model, props, this.game);\n};","class PhaserNeutrinoContext {\n\n  constructor(renderer, effectsBasePath = \"\", texturesBasePath = \"\") {\n    this.renderer = renderer;\n    this.neutrino = new NeutrinoParticles();\n    this.effectsBasePath = effectsBasePath;\n    this.texturesBasePath = texturesBasePath;\n    this.trimmedExtensionLookupFirst = true;\n\n    if (renderer.type === Phaser.PIXI.WEBGL_RENDERER) {\n      this.materials = new PhaserNeutrinoMaterials(renderer);\n    }\n  }\n\n  initializeNoise(path, success, fail) {\n    this.neutrino.initializeNoise(path, success, fail);\n  }\n\n  loadEffect(path, success, fail) {\n    this.neutrino.loadEffect(path, success, fail);\n  }\n}","class PhaserNeutrinoEffect extends Phaser.Group {\n\n  constructor(effectModel, position, game, rotation, scale) {\n    super(game, null);\n    this._renderCanvas = this.renderCanvas;\n    this._renderWebGL = this.renderWebGL;\n\n    this.ctx = effectModel.ctx;\n    this.effectModel = effectModel;\n    this.effect = null;\n    this.position.set(position[0], position[1]);\n    this.positionZ = position[2];\n\n    this.onReady = new Phaser.Signal();\n\n    if (rotation)\n      this.rotation = rotation;\n\n    if (Array.isArray(scale)) {\n      this.scale.x = scale[0];\n      this.scale.y = scale[1];\n      this.scaleZ = scale[2];\n    } else {\n      this.scaleZ = 1;\n    }\n\n    if (effectModel.isReady) {\n      this._onEffectReady();\n    } else {\n      effectModel.onReady.addOnce(function () {\n        this._onEffectReady();\n      }, this);\n    }\n  }\n\n  get isReady(){\n    return this.effect !== null;\n  }\n\n  updateParticles(dt) {\n    if (this.effect !== null) {\n      this.effect.update(dt, [this.position.x / this.scale.x, this.position.y / this.scale.y, this.positionZ / this.scaleZ],\n        this.ctx.neutrino.axisangle2quat_([0, 0, 1], this.rotation % 360));\n    }\n  }\n\n  renderCanvas(renderer) {\n    if (this.isReady) {\n      renderer.context.setTransform(this.scale.x, 0, 0, this.scale.y, 0, 0);\n      this.effect.draw(renderer.context);\n    }\n  };\n\n  renderWebGL(renderer) {\n    if (!this.isReady) return;\n\n    const gl = renderer.gl;\n\n    const renderSession = game.renderer.renderSession;\n    renderSession.spriteBatch.stop();\n    const projection = renderSession.projection;\n    const offset = renderSession.offset;\n    const position = this.position;\n    // console.log('projection', projection,'position',position,'offset',offset)\n    // this.ctx.materials.setup([position.x, -position.y], [offset.x, offset.y], [this.scale.x, this.scale.y]);\n    this.ctx.materials.setup([projection.x, projection.y], [offset.x, offset.y], [this.scale.x, this.scale.y]);\n\n    this.effect.fillGeometryBuffers([1, 0, 0], [0, -1, 0], [0, 0, -1]);\n\n    this.renderBuffers.updateGlBuffers();\n    this.renderBuffers.bind();\n\n    for (let renderCallIdx = 0; renderCallIdx < this.renderBuffers.numRenderCalls; ++renderCallIdx) {\n      const renderCall = this.renderBuffers.renderCalls[renderCallIdx];\n      const texIndex = this.effect.model.renderStyles[renderCall.renderStyleIndex].textureIndices[0];\n\n      //ref to pixi texture\n      const texture = this.effectModel.textures[texIndex];\n\n      //instance of https://developer.mozilla.org/en-US/docs/Web/API/WebGLTexture\n      const glTexture = texture.baseTexture._glTextures[0];//game.renderer.glContextId];\n\n      gl.activeTexture(gl.TEXTURE0);\n      gl.bindTexture(gl.TEXTURE_2D, glTexture);\n\n      const materialIndex = this.effect.model.renderStyles[renderCall.renderStyleIndex].materialIndex;\n      switch (this.effect.model.materials[materialIndex]) {\n        default: this.ctx.materials.switchToNormal(renderer); break;\n        case 1: this.ctx.materials.switchToAdd(renderer); break;\n        case 2: this.ctx.materials.switchToMultiply(renderer); break;\n      }\n\n      gl.drawElements(gl.TRIANGLES, renderCall.numIndices, gl.UNSIGNED_SHORT, renderCall.startIndex * 2);\n    }\n\n  }\n\n  restart(position, rotation) {\n    if (position) {\n      this.position.x = position[0];\n      this.position.y = position[1];\n      this.positionZ = position[2];\n    }\n\n    if (rotation) {\n      this.rotation = rotation;\n    }\n\n    this.effect.restart([this.position.x / this.scale.x, this.position.y / this.scale.y, this.positionZ / this.scaleZ],\n      rotation ? this.ctx.neutrino.axisangle2quat_([0, 0, 1], rotation % 360) : null);\n  }\n\n  resetPosition(position, rotation) {\n    if (position) {\n      this.position.x = position[0];\n      this.position.y = position[1];\n      this.positionZ = position[2];\n    }\n\n    if (rotation) {\n      this.rotation = rotation;\n    }\n\n    this.effect.resetPosition([this.position.x / this.scale.x, this.position.y / this.scale.y, this.positionZ / this.scaleZ],\n      rotation ? this.ctx.neutrino.axisangle2quat_([0, 0, 1], rotation % 360) : null);\n  }\n\n  setPropertyInAllEmitters(name, value) {\n    this.effect.setPropertyInAllEmitters(name, value);\n  }\n\n  getNumParticles() {\n    return this.effect.getNumParticles();\n  }\n\n  _onEffectReady() {\n\n    const position = [this.position.x / this.scale.x, this.position.y / this.scale.y, this.positionZ / this.scaleZ];\n    const rotation = this.ctx.neutrino.axisangle2quat_([0, 0, 1], this.rotation % 360);\n\n    if (this.effectModel.ctx.renderer.type === Phaser.PIXI.CANVAS_RENDERER) {\n      this.effect = this.effectModel.effectModel.createCanvas2DInstance(position, rotation);\n      this.effect.textureDescs = this.effectModel.textureImageDescs;\n    } else {\n      this.renderBuffers = new PhaserNeutrinoRenderBuffers(this.ctx);\n      this.effect = this.effectModel.effectModel.createWGLInstance(position, rotation, this.renderBuffers);\n      this.effect.texturesRemap = this.effectModel.texturesRemap;\n\n      //get phaser to create webgl texture(s)\n      this.effectModel.textures.forEach(texture=>{\n        game.renderer.updateTexture(texture.baseTexture);\n      });\n    }\n\n    this.onReady.dispatch();\n  }\n}","class PhaserNeutrinoEffectModel {\n\n  constructor(context, effectPath) {\n\n    this.ctx = context;\n    this.effectPath = effectPath;\n    this.effectModel = null;\n    this.numTexturesToLoadLeft = -1;\n    this.texturesRemap = null;\n\n    this._names = {};\n\n    this.onReady = new Phaser.Signal();\n\n    var pixiNeutrinoEffect = this;\n    this.ctx.neutrino.loadEffect(this.ctx.effectsBasePath + effectPath, function (effectModel) {\n      pixiNeutrinoEffect._onEffectLoaded(effectModel);\n    });\n\n    game.load.onFileComplete.add((progress, key, success) => {\n        //console.log('onFileComplete', progress, key, success)\n        const {texturePath, imageIndex} = this._names[key];\n        const tx = this._getNewTexture(texturePath);\n        this._onTextureLoaded(imageIndex, tx);\n    });\n\n  }\n\n  get isReady(){\n    return this.numTexturesToLoadLeft === 0;\n  }\n\n  _getKey(name){\n    if (this.ctx.trimmedExtensionLookupFirst) name = name.replace(/\\.[^/.]+$/, \"\");\n    return name;\n  }\n\n  _getNewTexture(id){\n    //if (this.ctx.trimmedExtensionLookupFirst) id = id.replace(/\\.[^/.]+$/, \"\");\n    id = this._getKey(id);\n    //TODO - see if theres a better way of accessing this image data...\n    const imageCache = game.cache._cache.image;\n    let imageData = imageCache[id];\n    if(!imageData){\n      let texture = null;\n      //have to check each cache entry :(\n      //(this is so much easier in pixi.js where all textures go into one cache!)\n      Object.keys(imageCache).forEach(name => {\n        const data = imageCache[name], fNames = data.frameData._frameNames;\n        if(fNames && fNames.hasOwnProperty(id)){\n          //this one contains the subtexture we are looking for\n          // - get a texture from it\n          const frameIndex = fNames[id];\n          const frame = data.frameData._frames[frameIndex];\n          const rect = new PIXI.Rectangle(frame.x, frame.y, frame.width, frame.height);\n          //console.log('frame', frame, 'rect',rect)\n          //PIXI.Texture(baseTexture, frame, crop, trim)\n          texture = new PIXI.Texture(data.base, rect, rect);\n          //just in case, store the rect on the texture as is done in recent pixi version\n          texture.orig = rect;\n        }\n      });\n\n      return texture;\n    } else {\n      const baseTexture = imageData.base;\n      return new Phaser.PIXI.Texture(baseTexture, imageData.frame);\n    }\n\n  }\n\n  /**\n   *\n   * @param effectModel\n   * @private\n   */\n  _onEffectLoaded(effectModel) {\n    this.effectModel = effectModel;\n    this.textures = [];\n    this.textureImageDescs = [];\n    const numTextures = effectModel.textures.length;\n    this.numTexturesToLoadLeft = numTextures;\n\n    for (let imageIndex = 0; imageIndex < numTextures; ++imageIndex) {\n      const texturePath = effectModel.textures[imageIndex];\n      let texture = this._getNewTexture(texturePath);\n\n      if (!texture){\n        this._loadTexture(texturePath, imageIndex);\n      } else {\n        if (texture.baseTexture.hasLoaded) {\n          this._onTextureLoaded(imageIndex, texture);\n        } else {\n          const callback = function (self, imageIndex, texture) {\n            texture.off('update', callback);\n            return function () {\n              self._onTextureLoaded(imageIndex, texture);\n            }\n          } (this, imageIndex, texture);\n          texture.on('update', callback);\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param texturePath\n   * @param imageIndex\n   * @returns {Phaser.Loader}\n   * @private\n   */\n  _loadTexture(texturePath, imageIndex) {\n    const key = this._getKey(texturePath);\n    this._names[key] = {texturePath, imageIndex};\n    //console.log('_loadTexture', this.ctx.texturesBasePath + texturePath)\n    const loader = game.load.image(key, this.ctx.texturesBasePath + texturePath);\n    loader.start();\n    return loader;\n  }\n\n  /**\n   *\n   * @param index\n   * @param texture\n   * @private\n   */\n  _onTextureLoaded(index, texture) {\n    this.textures[index] = texture;\n\n    this.numTexturesToLoadLeft--;\n\n    if (this.ctx.renderer.type === Phaser.PIXI.CANVAS_RENDERER) {\n      const image = texture.baseTexture.source;\n      this.textureImageDescs[index] = new this.ctx.neutrino.ImageDesc(image, texture.crop.x, texture.crop.y,\n        texture.crop.width, texture.crop.height);\n    }\n\n    if (this.numTexturesToLoadLeft === 0) {\n\n      if(this.ctx.renderer.type === Phaser.PIXI.WEBGL_RENDERER){\n        this._initTexturesRemapIfNeeded();\n      }\n      //this.emit('ready', this);\n      this.onReady.dispatch();\n    }\n  }\n\n  _isSubtexture(texture){\n    if(!texture) return false;\n    return texture.frame.width < texture.baseTexture.width || texture.frame.height < texture.baseTexture.height;\n  }\n\n  _initTexturesRemapIfNeeded() {\n    let remapNeeded = false;\n\n    for (var texIdx = 0; texIdx < this.textures.length; ++texIdx) {\n      //checks if its an atlas subtexture\n      if (this._isSubtexture(this.textures[texIdx])) {\n        remapNeeded = true;\n        break;\n      }\n    }\n\n    this.texturesRemap = [];\n    if (remapNeeded) {\n      const n = this.textures.length;\n      for (let texIdx = 0; texIdx < n; ++texIdx) {\n        const texture = this.textures[texIdx],\n          crop = texture.crop,\n          base = texture.baseTexture;\n\n        this.texturesRemap[texIdx] = new this.ctx.neutrino.SubRect(\n          crop.x / base.width,\n          1.0 - (crop.y + crop.height) / base.height,\n          crop.width / base.width,\n          crop.height / base.height\n        );\n      }\n    }\n  }\n}","class PhaserNeutrinoShader {\n  constructor(program) {\n    this.program = program;\n    this._UID = PIXI._UID++;\n    this.attributes = [program.vertexPositionAttribute, program.colorAttribute, program.textureCoordAttribute];\n  }\n}\n\nclass PhaserNeutrinoMaterials {\n\n  constructor(renderer) {\n    this.gl = renderer.gl;\n\n    var vertexShaderSource = \"\\\n/* NeutrinoParticles Vertex Shader */ \\n\\\n\\n\\\nattribute vec3 aVertexPosition;\\n\\\nattribute vec2 aTextureCoord;\\n\\\nattribute vec4 aColor; \\n\\\n\\n\\\nuniform vec2 projectionVector;\\n\\\nuniform vec2 offsetVector; \\n\\\nuniform vec2 scale;\\n\\\n\\n\\\nvarying vec4 vColor;\\n\\\nvarying vec2 vTextureCoord;\\n\\\n\\n\\\nconst vec2 center = vec2(-1.0, 1.0); \\n\\\n\\n\\\nvoid main(void) {\\n\\\ngl_Position = vec4(((aVertexPosition.xy * scale + offsetVector) / projectionVector) + center , 0.0, 1.0); \\n\\\n\tvColor = vec4(aColor.rgb * aColor.a, aColor.a);\\n\\\n\tvTextureCoord = vec2(aTextureCoord.x, 1.0 - aTextureCoord.y);\\n\\\n}\";\n\n    var fragmentShaderSource = \"\\\n/* NeutrinoParticles Fragment Shader (Normal, Add materials) */ \\n\\\n\\n\\\nprecision mediump float;\\n\\\n\\n\\\nvarying vec4 vColor;\\n\\\nvarying vec2 vTextureCoord;\\n\\\n\\n\\\nuniform sampler2D uSampler;\\n\\\n\\n\\\nvoid main(void) {\\n\\\n\tgl_FragColor = vColor * texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n\\\n}\";\n\n    var fragmentShaderMultiplySource = \"\\\n/* NeutrinoParticles Fragment Shader (Multiply material) */ \\n\\\n\\n\\\nprecision mediump float;\\n\\\n\\n\\\nvarying vec4 vColor;\\n\\\nvarying vec2 vTextureCoord;\\n\\\n\\n\\\nuniform sampler2D uSampler;\\n\\\n\\n\\\nvoid main(void)\\n\\\n{\\n\\\nvec4 texel = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n\\\nvec3 rgb = vColor.rgb * texel.rgb;\\n\\\nfloat alpha = vColor.a * texel.a;\\n\\\ngl_FragColor = vec4(mix(vec3(1, 1, 1), rgb, alpha), 1);\\n\\\n}\";\n\n    this.shaderProgram = this._makeShaderProgram(vertexShaderSource, fragmentShaderSource);\n    this.shaderProgramMultiply = this._makeShaderProgram(vertexShaderSource, fragmentShaderMultiplySource);\n\n    this.shaderProgram.shader = new PhaserNeutrinoShader(this.shaderProgram);\n    this.shaderProgramMultiply.shader = new PhaserNeutrinoShader(this.shaderProgramMultiply);\n    renderer.shaderManager.setShader(this.shaderProgram.shader);\n\n    this.pMatrix = null;\n    this.currentProgram = null;\n  }\n\n  shutdown() {\n  }\n\n  positionAttribLocation() {\n    return this.shaderProgram.vertexPositionAttribute;\n  }\n\n  colorAttribLocation() {\n    return this.shaderProgram.colorAttribute;\n  }\n\n  texAttribLocation(index) {\n    return this.shaderProgram.textureCoordAttribute[index];\n  }\n\n  setup(projectionVector, offsetVector, scale) {\n    this.projectionVector = projectionVector.slice();\n    this.offsetVector = offsetVector.slice();\n    this.scale = scale.slice();\n    this.currentProgram = null;\n  }\n\n  switchToNormal(renderer) {\n    this._setProgram(renderer, this.shaderProgram);\n    renderer.blendModeManager.setBlendMode(0);\n  }\n\n  switchToAdd(renderer) {\n    this._setProgram(renderer, this.shaderProgram);\n    renderer.blendModeManager.setBlendMode(1);\n  }\n\n  switchToMultiply(renderer) {\n    this._setProgram(renderer, this.shaderProgramMultiply);\n    renderer.blendModeManager.setBlendMode(2);\n  }\n\n  _setProgram(renderer, program) {\n    var gl = this.gl;\n    if (program !== this.currentProgram) {\n      renderer.shaderManager.setShader(program.shader);\n      // console.log('_setProgram',program.pMatrixUniform, this.pMatrix)\n      gl.uniform2fv(program.projectionVectorUniform, this.projectionVector);\n      gl.uniform2fv(program.offsetVectorUniform, this.offsetVector);\n      gl.uniform1i(program.samplerUniform, 0);\n      gl.uniform2f(program.scaleUniform, this.scale[0], this.scale[1]);\n\n      this.currentProgram = program;\n    }\n  }\n\n  _makeShaderProgram(vertexShaderSource, fragmentShaderSource) {\n    var gl = this.gl;\n\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexShaderSource);\n    gl.compileShader(vertexShader);\n\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      alert(gl.getShaderInfoLog(vertexShader));\n      return null;\n    }\n\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentShaderSource);\n    gl.compileShader(fragmentShader);\n\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      alert(gl.getShaderInfoLog(fragmentShader));\n      return null;\n    }\n\n    var shaderProgram = gl.createProgram();\n    gl.attachShader(shaderProgram, vertexShader);\n    gl.attachShader(shaderProgram, fragmentShader);\n    gl.linkProgram(shaderProgram);\n\n    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n      alert(\"Could not initialise shaders\");\n    }\n\n    gl.useProgram(shaderProgram);\n\n    shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, \"aVertexPosition\");\n    shaderProgram.colorAttribute = gl.getAttribLocation(shaderProgram, \"aColor\");\n    shaderProgram.textureCoordAttribute = [gl.getAttribLocation(shaderProgram, \"aTextureCoord\")];\n\n    shaderProgram.projectionVectorUniform = gl.getUniformLocation(shaderProgram, \"projectionVector\");\n    shaderProgram.offsetVectorUniform = gl.getUniformLocation(shaderProgram, \"offsetVector\");\n    shaderProgram.samplerUniform = gl.getUniformLocation(shaderProgram, \"uSampler\");\n    shaderProgram.scaleUniform = gl.getUniformLocation(shaderProgram, \"scale\");\n\n    return shaderProgram;\n  }\n}","class PhaserNeutrinoRenderBuffers {\n  constructor(context, geometryBuffers) {\n    this.ctx = context;\n    this.gl = this.ctx.renderer.gl;\n\n    this.positions = null;\n    this.colors = null;\n    this.texCoords = [];\n    this.maxNumVertices = 0;\n    this.numVertices = 0;\n    this.indices = null;\n\n    this.renderCalls = [];\n    this.maxNumRenderCalls = 0;\n    this.numRenderCalls = 0;\n  }\n\n  initialize(maxNumVertices, texChannels, indices, maxNumRenderCalls) {\n    var gl = this.gl;\n\n    this.positions = new Float32Array(new ArrayBuffer(4 * maxNumVertices * 3));\n    this.colors = new Uint8Array(new ArrayBuffer(4 * maxNumVertices));\n    this.texCoords = [];\n    for (var texChannel = 0; texChannel < texChannels.length; ++texChannel) {\n      this.texCoords[texChannel] = new Float32Array(new ArrayBuffer(4 * maxNumVertices * texChannels[texChannel]));\n      this.texCoords[texChannel].numComponents = texChannels[texChannel];\n    }\n    this.maxNumVertices = maxNumVertices;\n\n    this.indices = new Uint16Array(new ArrayBuffer(2 * indices.length));\n    this.indices.set(indices, 0);\n\n    this.maxNumRenderCalls = maxNumRenderCalls;\n\n    this.positionBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.positions, gl.DYNAMIC_DRAW);\n\n    this.colorBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.colorBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, this.colors, gl.DYNAMIC_DRAW);\n\n    this.texBuffers = [];\n    for (var texIndex = 0; texIndex < this.texCoords.length; ++texIndex) {\n      var buffer = gl.createBuffer();\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n      gl.bufferData(gl.ARRAY_BUFFER, this.texCoords[texIndex], gl.DYNAMIC_DRAW);\n      this.texBuffers.push(buffer);\n    }\n\n    this.indicesBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this.indices, gl.STATIC_DRAW);\n  }\n\n  pushVertex(vertex) {\n    this.positions.set(vertex.position, this.numVertices * 3);\n    this.colors.set(vertex.color, this.numVertices * 4);\n\n    for (var texIndex = 0; texIndex < vertex.texCoords.length; ++texIndex) {\n      this.texCoords[texIndex].set(vertex.texCoords[texIndex],\n        this.numVertices * this.texCoords[texIndex].numComponents);\n    }\n\n    ++this.numVertices;\n  }\n\n  pushRenderCall(rc) {\n\n    if (this.numRenderCalls >= this.renderCalls.length)\n      this.renderCalls.push(Object.assign({}, rc));\n    else\n      Object.assign(this.renderCalls[this.numRenderCalls], rc);\n\n    ++this.numRenderCalls;\n  }\n\n  cleanup() {\n    this.numVertices = 0;\n    this.numRenderCalls = 0;\n  }\n\n  updateGlBuffers() {\n    var gl = this.gl;\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.positions, 0, this.numVertices * 3);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.colorBuffer);\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.colors, 0, this.numVertices * 4);\n\n    this.texBuffers.forEach(function (buffer, index) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.texCoords[index], 0, this.numVertices *\n        this.texCoords[index].numComponents);\n    }, this);\n  }\n\n  bind() {\n    var gl = this.gl;\n    var materials = this.ctx.materials;\n\n    {\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n      // attribute is enabled inside PIXI\n      //gl.enableVertexAttribArray(materials.positionAttribLocation());\n      gl.vertexAttribPointer(materials.positionAttribLocation(), 3, gl.FLOAT, false, 0, 0);\n    }\n\n    {\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.colorBuffer);\n      // attribute is enabled inside PIXI\n      //gl.enableVertexAttribArray(materials.colorAttribLocation());\n      gl.vertexAttribPointer(materials.colorAttribLocation(), 4, gl.UNSIGNED_BYTE, true, 0, 0);\n    }\n\n    this.texBuffers.forEach(function (buffer, index) {\n\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n      // attribute is enabled inside PIXI\n      //gl.enableVertexAttribArray(materials.texAttribLocation(index));\n      gl.vertexAttribPointer(materials.texAttribLocation(index),\n        this.texCoords[index].numComponents, gl.FLOAT, false, 0, 0);\n\n    }, this);\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n  }\n\n  shutdown() {\n    var gl = this.gl;\n\n    gl.deleteBuffer(this.positionBuffer);\n    gl.deleteBuffer(this.colorBuffer);\n\n    this.texBuffers.forEach(function (buffer) {\n      gl.deleteBuffer(buffer);\n    }, this);\n  }\n}"]}